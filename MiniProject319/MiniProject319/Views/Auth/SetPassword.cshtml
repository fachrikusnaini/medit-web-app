@using MiniProject319.ViewModels;
@model VMm_user
<style>
    .required:after {
        content: "*";
        color: red;
    }
</style>
<div class="container">
    <div class="row">
        <div class="col">
        </div>
        <div class="col-8">
            <h4 class="text-primary"><b>Set Password</b></h4>
            <div class="container-fluid">
                <div class="row">
                    <form asp-action="SetPassword" method="post" enctype="multipart/form-data" id="form_register">

                        <span class="text-secondary mb-3">Masukkan password baru untuk akun anda</span>
                        <div class="form-group mb-3">
                            <label class="text-secondary required" for="Password">Password</label>
                            <input type="password" class="form-control border-info" id="Password" name="Password">
                        </div>
                        <div class="form-group mb-3">
                            <label class="text-secondary required" for="re_password">Masukkan ulang password</label>
                            <input type="password" class="form-control border-info" id="re_password" name="re_password">
                        </div>
                        <div class="clearfix mt-5 text-center">
                            <button type="submit" class="btn btn-primary btn-rounded" id="btn_setPassword">Set Password</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="col">
        </div>
    </div>
</div>
<script>
    $("#form_register").validate({
        errorClass: "text-danger",
        rules: {
            Password: {
                required: true,
                strong_password: true
            },
            re_password: {
                equalTo: "#Password",
                required: true,
            },
        },
        messages: {
            Password: {
                required: "Please fill password"
            },
            re_password: {
                equalTo: "Please fill the same value again.",
                required: "Please fill re-password",
            },
        },
        submitHandler: function (form) {
            var id = $("#Id").val()
            var formData = new FormData();
            var dataForm = $(form).serializeArray();

            $.each(dataForm, function (key, input) {
                formData.append(input.name, input.value)
            })


            $.ajax({
                url: "/Auth/SetPassword",
                type: "post",
                data: formData,
                processData: false,
                contentType: false,
                dataType: "json",
                success: function (response) {
                    var data = response.dataResponse
                    if (data.success) {
                        $("#modal_body").empty()
                        $("#modal_body").load("/Auth/Biodata")
                        $("#modal").modal("show")
                    } else {
                        toastr.errorClass(data.message)
                    }
                }
            })
        }
    })

    $.validator.addMethod("strong_password", function (value, element) {
        let password = value;
        if (!(/^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[@@#$%&])(.{8,20}$)/.test(password))) {
            return false;
        }
        return true;
    }, function (value, element) {
        let password = $(element).val();
        if (!(/^(.{8,20}$)/.test(password))) {
            return 'Password must be between 8 to 20 characters long.';
        }
        else if (!(/^(?=.*[A-Z])/.test(password))) {
            return 'Password must contain at least one uppercase.';
        }
        else if (!(/^(?=.*[a-z])/.test(password))) {
            return 'Password must contain at least one lowercase.';
        }
        else if (!(/^(?=.*[0-9])/.test(password))) {
            return 'Password must contain at least one digit.';
        }
        else if (!(/^(?=.*[@@#$%&])/.test(password))) {
            return "Password must contain special characters from @@#$%&.";
        }
        return false;
    });

    
</script>